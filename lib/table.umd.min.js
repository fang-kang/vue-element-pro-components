/* * Copyright © 2022-2022 fangkang * Released under the MIT License. */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("packages/form/src/type"),require("src/utils"),require("src/directive/clipboard/index.js")):"function"==typeof define&&define.amd?define(["packages/form/src/type","src/utils","src/directive/clipboard/index.js"],t):(e=e||self).table=t(e.type,e.utils,e.clipboard)}(this,(function(e,t,n){"use strict";function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(n,!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}n=n&&n.hasOwnProperty("default")?n.default:n;var l="object"==typeof global&&global&&global.Object===Object&&global,c="object"==typeof self&&self&&self.Object===Object&&self,u=l||c||Function("return this")(),s=u.Symbol,p=Object.prototype,f=p.hasOwnProperty,d=p.toString,y=s?s.toStringTag:void 0;var b=Object.prototype.toString;var h="[object Null]",v="[object Undefined]",g=s?s.toStringTag:void 0;function m(e){return null==e?void 0===e?v:h:g&&g in Object(e)?function(e){var t=f.call(e,y),n=e[y];try{e[y]=void 0;var o=!0}catch(e){}var r=d.call(e);return o&&(t?e[y]=n:delete e[y]),r}(e):function(e){return b.call(e)}(e)}var _="[object Symbol]";var O=/\s/;var w=/^\s+/;function S(e){return e?e.slice(0,function(e){for(var t=e.length;t--&&O.test(e.charAt(t)););return t}(e)+1).replace(w,""):e}function k(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}var j=NaN,T=/^[-+]0x[0-9a-f]+$/i,x=/^0b[01]+$/i,C=/^0o[0-7]+$/i,H=parseInt;function F(e){if("number"==typeof e)return e;if(function(e){return"symbol"==typeof e||function(e){return null!=e&&"object"==typeof e}(e)&&m(e)==_}(e))return j;if(k(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=k(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=S(e);var n=x.test(e);return n||C.test(e)?H(e.slice(2),n?2:8):T.test(e)?j:+e}var $=function(){return u.Date.now()},q="Expected a function",P=Math.max,A=Math.min;function E(e,t,n){var o,r,i,a,l,c,u=0,s=!1,p=!1,f=!0;if("function"!=typeof e)throw new TypeError(q);function d(t){var n=o,i=r;return o=r=void 0,u=t,a=e.apply(i,n)}function y(e){var n=e-c;return void 0===c||n>=t||n<0||p&&e-u>=i}function b(){var e=$();if(y(e))return h(e);l=setTimeout(b,function(e){var n=t-(e-c);return p?A(n,i-(e-u)):n}(e))}function h(e){return l=void 0,f&&o?d(e):(o=r=void 0,a)}function v(){var e=$(),n=y(e);if(o=arguments,r=this,c=e,n){if(void 0===l)return function(e){return u=e,l=setTimeout(b,t),s?d(e):a}(c);if(p)return clearTimeout(l),l=setTimeout(b,t),d(c)}return void 0===l&&(l=setTimeout(b,t)),a}return t=F(t)||0,k(n)&&(s=!!n.leading,i=(p="maxWait"in n)?P(F(n.maxWait)||0,t):i,f="trailing"in n?!!n.trailing:f),v.cancel=function(){void 0!==l&&clearTimeout(l),u=0,o=c=r=l=void 0},v.flush=function(){return void 0===l?a:h($())},v}var L=function(e,t,n,o,r,i,a,l,c,u){"boolean"!=typeof a&&(c=l,l=a,a=!1);var s,p="function"==typeof n?n.options:n;if(e&&e.render&&(p.render=e.render,p.staticRenderFns=e.staticRenderFns,p._compiled=!0,r&&(p.functional=!0)),o&&(p._scopeId=o),i?(s=function(e){(e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),t&&t.call(this,c(e)),e&&e._registeredComponents&&e._registeredComponents.add(i)},p._ssrRegister=s):t&&(s=a?function(){t.call(this,u(this.$root.$options.shadowRoot))}:function(e){t.call(this,l(e))}),s)if(p.functional){var f=p.render;p.render=function(e,t){return s.call(t),f(e,t)}}else{var d=p.beforeCreate;p.beforeCreate=d?[].concat(d,s):[s]}return n}; var B={name:"TableColumn",props:{child:{type:Object,default:function(){}}},methods:{clipboardSuccess:function(){this.$message({message:"复制成功",type:"success",duration:1500})},getTagOptions:function(e,t){var n={},r=e.tagOptions;return"string"==typeof r&&(n.type=r),"object"===o(r)?n=r:"function"==typeof r&&(n=r(t)||{}),a({},n)},formatShow:function(t,n,o){var r=t.showFormat;if(r&&"function"==typeof r)return r(n[t.key],n,o);if([e.types.select,e.types.checkBox,e.types.radio].includes(t.type)){var i=[];Array.isArray(t.options)?i=t.options:"function"==typeof t.options&&(i=t.options(n));var a=i.find((function(e){return String(e.value)===String(n[t.key])}));return a?a.name:""}return n[t.key]}}};var N=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-table-column",e._b({key:e.child.key,attrs:{align:e.child.align||"center",label:e.child.tableLabel||e.child.label}},"el-table-column",e.child.tableColumnOption,!1),[e._l(e.child.children,(function(t){return[t.children&&t.children.length?[n("table-column",{key:t[e.key],attrs:{child:t}})]:[n("el-table-column",e._b({key:t.key,attrs:{align:t.align||"center",label:t.tableLabel||t.label},scopedSlots:e._u([e.$slots[t.key+"Header"]?{key:"header",fn:function(n){return[e._t(t.key+"Header",null,{scope:n})]}}:null,{key:"default",fn:function(o){return[e._t(t.key,[t.copy?n("i",{directives:[{name:"clipboard",rawName:"v-clipboard:copy",value:o.row[t.key],expression:"scope.row[item.key]",arg:"copy"},{name:"clipboard",rawName:"v-clipboard:success",value:e.clipboardSuccess,expression:"clipboardSuccess",arg:"success"}],staticClass:"el-icon-copy-document",staticStyle:{cursor:"pointer",color:"#409eff","margin-right":"5px"}}):e._e(),e._v(" "),t.isTag?e._e():n("span",[e._v(e._s(e.formatShow(t,o.row,o)))]),e._v(" "),t.isTag?n("el-tag",e._b({},"el-tag",e.getTagOptions(t,o.row),!1),[e._v("\n              "+e._s(e.formatShow(t,o.row,o))+"\n            ")]):e._e()],{scope:o})]}}],null,!0)},"el-table-column",t.tableColumnOption,!1))]]}))],2)};N._withStripped=!0; var R={name:"ElProTable",components:{TableColumn:L({render:N,staticRenderFns:[]},void 0,B,"data-v-045db86f",!1,void 0,void 0,void 0)},directives:{clipboard:n},props:{updateText:{type:String,default:"修改"},deleteText:{type:String,default:"删除"},selection:{type:Boolean,default:!1},reserveSelection:{type:Boolean,default:!1},data:{type:Array,default:function(){return[]}},loading:{type:Boolean,default:!1},columns:{type:[Object,Array],required:!1,default:function(){}},updateProps:{type:Function,required:!1,default:function(){}},deleteProps:{type:Function,required:!1,default:function(){}},tableColumns:{type:[Object,Array,null],required:!1,default:null},tableOptions:{type:Object,required:!1,default:function(){}},deleteFunc:{type:Function,required:!1,default:function(){}},updateFunc:{type:Function,required:!1,default:function(){}},operationOptions:{type:Object,required:!1,default:function(){}},showOperation:{type:Boolean,required:!1,default:!0},autoHeight:{type:Boolean,required:!1,default:!0}},data:function(){return{tableHeight:"",debounceHeightListener:null}},computed:{tableColumn:function(){var e=this.tableColumns,n=this.columns;return e||(n?Array.isArray(n)?n.filter((function(e){return e.showInTable})):t.filterObject(n,(function(e){return e.showInTable})):{})},metadata:function(){var t=this.tableColumn;return Array.isArray(t)?t:Object.keys(t).map((function(n){var o=t[n],r=o.label,i=void 0===r?n:r,l=o.type,c=void 0===l?e.types.input:l,u=o.tableColumnOption;return a({},o,{key:n,label:i,type:c,tableColumnOption:void 0===u?{}:u,options:o.options})}))},tableSetting:function(){var e=a({data:this.data,highlightCurrentRow:!0,style:"width: 100%"},this.tableOptions||{});return this.tableHeight&&(e.height=this.tableHeight),e},processOperationOptions:function(){return a({fixed:"right",label:"操作",width:"150",align:"center"},this.operationOptions||{})},hasOperation:function(){return this.tableOptions?this.tableOptions.hasOperation:this.deleteFunc||this.updateFunc}},mounted:function(){this.autoHeight&&(this.setTableHeight(),this.setChangeHeightListener())},beforeDestroy:function(){this.debounceHeightListener&&window.removeEventListener("resize",this.debounceHeightListener)},methods:{getTagOptions:function(e,t){var n={},r=e.tagOptions;return"string"==typeof r&&(n.type=r),"object"===o(r)?n=r:"function"==typeof r&&(n=r(t)||{}),a({},n)},clipboardSuccess:function(){this.$message({message:"复制成功",type:"success",duration:1500})},handleDeleteFunc:function(e,t){var n=this;this.$confirm("此操作将永久删除该行, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){n.deleteFunc&&n.deleteFunc(e,t)})).catch((function(e){console.log(e)}))},setChangeHeightListener:function(){this.debounceHeightListener||(this.debounceHeightListener=E(this.setTableHeight,100)),window.addEventListener("resize",this.debounceHeightListener)},setTableHeight:function(){var e=document.querySelector(".el-pro-search"),t=document.querySelector("#el-pro-wrapper");if(e&&t){var n=document.querySelector(".el-pro-pagination"),o=n?n.clientHeight:0;this.tableHeight=t.offsetHeight-e.clientHeight-o-50+"px"}},formatShow:function(t,n,o){var r=t.showFormat;if(r&&"function"==typeof r)return r(n[t.key],n,o);if([e.types.select,e.types.checkBox,e.types.radio].includes(t.type)){var i=[];Array.isArray(t.options)?i=t.options:"function"==typeof t.options&&(i=t.options(n));var a=i.find((function(e){return String(e.value)===String(n[t.key])}));return a?a.name:""}return n[t.key]}}};var D=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-table",e._g(e._b({directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"table"},"el-table",e.tableSetting,!1),e.$listeners),[e.selection?n("el-table-column",{attrs:{type:"selection",align:"center","reserve-selection":e.reserveSelection,width:"60"}}):e._e(),e._v(" "),e._l(e.metadata,(function(t){return[t.children&&t.children.length?[n("table-column",{key:t.key,attrs:{child:t}})]:[n("el-table-column",e._b({key:t.key,attrs:{align:t.align||"center",label:t.tableLabel||t.label},scopedSlots:e._u([e.$slots[t.key+"Header"]?{key:"header",fn:function(n){return[e._t(t.key+"Header",null,{scope:n})]}}:null,{key:"default",fn:function(o){return[e._t(t.key,[t.copy?n("i",{directives:[{name:"clipboard",rawName:"v-clipboard:copy",value:o.row[t.key],expression:"scope.row[column.key]",arg:"copy"},{name:"clipboard",rawName:"v-clipboard:success",value:e.clipboardSuccess,expression:"clipboardSuccess",arg:"success"}],staticClass:"el-icon-copy-document",staticStyle:{cursor:"pointer",color:"#409eff","margin-right":"5px"}}):e._e(),e._v(" "),t.isTag?e._e():n("span",[e._v(e._s(e.formatShow(t,o.row,o)))]),e._v(" "),t.isTag?n("el-tag",e._b({},"el-tag",e.getTagOptions(t,o.row),!1),[e._v("\n              "+e._s(e.formatShow(t,o.row,o))+"\n            ")]):e._e()],{scope:o})]}}],null,!0)},"el-table-column",t.tableColumnOption,!1))]]})),e._v(" "),e.hasOperation&&e.showOperation?n("el-table-column",e._b({scopedSlots:e._u([{key:"default",fn:function(t){return[e._t("operationColumn",[n("div",{staticClass:"operationContainer"},[e._t("operationBefore",null,{scope:t}),e._v(" "),e._t("autoOperation",[e.updateFunc?n("el-button",e._b({attrs:{size:"small",type:"primary"},on:{click:function(n){return e.updateFunc(t.row,t.$index)}}},"el-button",e.updateProps(t.row,t.$index),!1),[e._v("\n              "+e._s(e.updateText)+"\n            ")]):e._e(),e._v(" "),e._t("operationMiddle",null,{scope:t}),e._v(" "),e.deleteFunc?n("el-button",e._b({attrs:{size:"small",type:"danger"},on:{click:function(n){return e.handleDeleteFunc(t.row,t.$index)}}},"el-button",e.deleteProps(t.row,t.$index),!1),[e._v("\n              "+e._s(e.deleteText)+"\n            ")]):e._e()],{scope:t}),e._v(" "),e._t("operationAfter",null,{scope:t})],2)],{scope:t})]}}],null,!0)},"el-table-column",e.processOperationOptions,!1)):e._e()],2)};D._withStripped=!0;var z=L({render:D,staticRenderFns:[]},void 0,R,void 0,!1,void 0,void 0,void 0);return z.install=function(e){e.component(z.name,z)},z}));
